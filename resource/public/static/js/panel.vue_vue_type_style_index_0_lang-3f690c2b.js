import{a2 as e,a3 as l,$ as a,_ as s,a4 as t}from"./@element-plus.icons-vue-e9c91902.js";import"./browser-f4ca2ed3.js";import"./vue-echarts-bffdbdc9.js";import{a as i,c as n}from"./element-plus-e665fdbc.js";import"./store-acbd10e3.js";import{e as o}from"./index-ecdd2562.js";import{u as r}from"./index-1fe6d5c5.js";import{u as c}from"./component-643e0931.js";import{w as u}from"./@vue.runtime-dom-532828a1.js";import{i as p}from"./index.umd.min-ead3793b.js";import{y as d,d as v,q as m,e as f,W as y,o as _,c as g,a as h,b as k,J as b,N as x,F as j,U as w,I as C,M as I,al as P,ak as z,p as D,_ as V,K as E,z as F}from"./@vue.runtime-core-6173334e.js";import{r as M,u as O,h as T}from"./@vue.reactivity-54707199.js";import{p as q,L as G,q as K}from"./@vue.shared-0cc4c744.js";import{_ as L}from"./_plugin-vue_export-helper-1b428a4d.js";import{f as N,_ as S,a as U}from"./viewer.vue_vue_type_script_setup_true_name_item-viewer_lang-a3c66bb9.js";import{i as $}from"./@vueuse.core-cb7ad152.js";function A(){return{space:d("space")}}const J={class:"item-category"},B={class:"item-category__head"},R=(e=>(P("data-v-6b2853a3"),e=e(),z(),e))((()=>h("span",null,"类型",-1))),W={class:"item-category__list"},H=["onClick","onContextmenu"],Q=v({name:"item-category"}),X=L(v({...Q,setup(a){const{service:s}=r(),{space:t}=A(),{ViewGroup:o}=c(),d=p.useForm(),v=M([]),P=M(""),z=m((()=>v.value.filter((e=>(e.name||"").includes(P.value)))));async function D(){return s.space.type.list({order:"createTime",sort:"asc"}).then((e=>{var l;e.unshift({name:"全部文件",id:void 0}),v.value=e,(null==(l=o.value)?void 0:l.selected)||E()}))}function V(e={}){var l;null==(l=d.value)||l.open({title:"添加分类",width:"400px",props:{labelPosition:"top"},dialog:{controls:["close"]},items:[{label:"分类名称",prop:"name",value:"",required:!0,component:{name:"el-input",props:{maxlength:20,clearable:!0}}}],form:{...e},on:{submit(l,{done:a,close:t}){let n=null;n=e.id?s.space.type.update({...l,id:e.id}):s.space.type.add(l),n.then((()=>{D(),t()})).catch((e=>{i.error(e.message),a()}))}}})}function E(e){var l,a;e||(e=v.value[0]),e&&(t.refresh({page:1,classifyId:e.id}),null==(l=o.value)||l.select(e),null==(a=o.value)||a.setTitle(e.name))}return f((()=>{D()})),(a,t)=>{const r=y("el-button"),c=y("el-icon"),v=y("el-empty"),m=y("el-scrollbar"),f=y("cl-form");return _(),g(j,null,[h("div",J,[h("div",B,[R,k(r,{type:"success",bg:"",size:"small",onClick:t[0]||(t[0]=e=>V())},{default:b((()=>[x("添加")])),_:1})]),h("div",W,[k(m,null,{default:b((()=>[h("ul",null,[(_(!0),g(j,null,w(O(z),((a,t)=>{var r,d;return _(),g("li",{key:t,class:q({"is-active":a.id==(null==(d=null==(r=O(o))?void 0:r.selected)?void 0:d.id)}),onClick:e=>E(a),onContextmenu:u((e=>function(e,{id:l,name:a}){if(!l)return!1;p.ContextMenu.open(e,{hover:{target:"item"},list:[{label:"刷新",callback(e){D(),e()}},{label:"编辑",callback(e){V({id:l,name:a}),e()}},{label:"删除",callback(e){n.confirm(`此操作将删除【${a}】下的文件, 是否继续?`,"提示",{type:"warning"}).then((()=>{s.space.type.delete({ids:[l]}).then((()=>{var e,a;i.success("删除成功"),l==(null==(a=null==(e=o.value)?void 0:e.selected)?void 0:a.id)&&E(),D()})).catch((e=>{i.error(e.message)}))})).catch((()=>null)),e()}}]})}(e,a)),["stop","prevent"])},[k(c,{class:"icon"},{default:b((()=>{var s,t;return[(null==(t=null==(s=O(o))?void 0:s.selected)?void 0:t.id)==a.id?(_(),C(O(e),{key:0})):(_(),C(O(l),{key:1}))]})),_:2},1024),h("span",null,G(a.name),1)],42,H)})),128)),0==O(z).length?(_(),C(v,{key:0,"image-size":80})):I("",!0)])])),_:1})])]),k(f,{ref_key:"Form",ref:d},null,512)],64)}}}),[["__scopeId","data-v-6b2853a3"]]),Y={class:"item-video"},Z=["src"],ee=v({name:"item-video"}),le=L(v({...ee,props:{data:Object,list:Array},setup(e,{expose:l}){const t=e,{space:i}=A(),n=M(),o=m((()=>t.data||{})),r=m((()=>void 0===o.value.progress||100===o.value.progress));function c(){var e;i.list.value.forEach((e=>{e.isPlay=o.value.id==e.id})),null==(e=n.value)||e.play()}function p(){var e;const l=i.list.value.find((e=>e.id==o.value.id));l&&(l.isPlay=!1),null==(e=n.value)||e.pause()}return D((()=>o.value.isPlay),(e=>{e?c():p()})),l({play:c,pause:p}),(e,l)=>{const t=y("el-icon");return _(),g("div",Y,[h("video",{ref_key:"Video",ref:n,src:O(o).url},null,8,Z),O(r)?(_(),g(j,{key:0},[O(o).isPlay?(_(),C(t,{key:0,class:"icon is-pause",onClick:u(p,["stop"])},{default:b((()=>[k(O(a))])),_:1},8,["onClick"])):(_(),C(t,{key:1,class:"icon is-play",onClick:u(c,["stop"])},{default:b((()=>[k(O(s))])),_:1},8,["onClick"]))],64)):I("",!0)])}}}),[["__scopeId","data-v-5c7586d0"]]),ae={class:"item-file__wrap"},se=["onContextmenu"],te={key:0,class:"item-file__error"},ie={class:"image-error"},ne={key:2,class:"item-file__name"},oe={class:"item-file__progress-bar"},re={class:"item-file__progress-value"},ce={key:2,class:"item-file__mask"},ue=v({name:"item-file"}),pe=L(v({...ue,props:{data:Object,list:Array},emits:["select","remove"],setup(e,{emit:l}){const a=e,{copy:s}=$(),{space:t}=A(),n=M(),r=m((()=>a.data||{})),c=m((()=>t.selection.value.findIndex((e=>e.id===r.value.id)))),d=m((()=>c.value>=0)),v=m((()=>r.value.preload||r.value.url)),f=m((()=>U(r.value.type||"")));function x(){l("select",r.value)}function w(e){p.ContextMenu.open(e,{hover:{target:"item-file__wrap"},list:[{label:"预览",callback(e){var l,s;"image"==r.value.type?null==(s=n.value)||s.open(r.value.url,null==(l=a.list)?void 0:l.filter((e=>"image"==e.type)).map((e=>e.url))):window.open(r.value.url),e()}},{label:"复制地址",callback(e){r.value.url&&(s(r.value.url),i.success("复制成功")),e()}},{label:d.value?"取消选中":"选中",callback(e){x(),e()}},{label:"删除",callback(e){l("remove",r.value),e()}}]})}return(l,a)=>{var s,t;const i=y("el-image"),p=y("el-progress");return _(),g(j,null,[h("div",ae,[h("div",{class:q(["item-file",[`is-${O(r).type}`]]),onClick:x,onContextmenu:u(w,["stop","prevent"])},[O(r).error?(_(),g("div",te,"上传失败："+G(O(r).error),1)):(_(),g(j,{key:1},["image"===O(r).type?(_(),C(i,{key:0,fit:"contain",src:O(v),lazy:""},{error:b((()=>[h("div",ie,[h("span",null,G(O(v)),1)])])),_:1},8,["src"])):"video"===O(r).type?(_(),C(le,{key:1,data:O(r),list:e.list},null,8,["data","list"])):(_(),g("span",ne,G(O(N)(O(v)))+"."+G(O(o)(O(v))),1)),h("span",{class:"item-file__type",style:K({backgroundColor:null==(s=O(f))?void 0:s.color})},G(null==(t=O(f))?void 0:t.label),5),O(r).progress>0&&O(r).progress<100?(_(),g(j,{key:3},[h("div",oe,[k(p,{percentage:O(r).progress,"show-text":!1},null,8,["percentage"])]),h("span",re,G(O(r).progress),1)],64)):I("",!0)],64)),O(d)?(_(),g("div",ce,[h("span",null,G(O(c)+1),1)])):I("",!0)],42,se)]),k(S,{ref_key:"Viewer",ref:n},null,512)],64)}}}),[["__scopeId","data-v-e2d978fb"]]),de={class:"cl-upload-panel__header"},ve={style:{margin:"0px 10px"}},me={"infinite-scroll-immediate":!1},fe={key:1,class:"empty"},ye=h("p",null,"将文件拖到此处，或点击按钮上传",-1),_e=v({name:"cl-upload-panel"}),ge=v({..._e,props:{limit:{type:Number,default:99},accept:String,selectable:Boolean},emits:["selection-change"],setup(e,{expose:l,emit:a}){const s=e,{service:o,browser:u}=r(),{ViewGroup:p}=c(),d=M(),v=M(),m=M(!1),f=M([]),P=M([]),z=T({page:1,size:50,total:0});function G(){f.value=[]}function K(e){var l,a;o.space.info.add({classifyId:null==(a=null==(l=p.value)?void 0:l.selected)?void 0:a.id,...e}).then((l=>{e.id=l.id})).catch((e=>{i.error(e.message)}))}function L(e){P.value.unshift(e)}const N={page:1};async function S(e){var l;G(),Object.assign(N,{type:null==(l=s.accept)?void 0:l.split("/")[0],...z,...e}),1==N.page&&(m.value=!0),await o.space.info.page(N).then((e=>{Object.assign(z,e.pagination),1==N.page&&(P.value=[]),P.value.push(...e.list)})),m.value=!1}function U(e){const l=f.value.findIndex((l=>l.id===e.id));l>=0?f.value.splice(l,1):1==s.limit?f.value=[e]:f.value.length<s.limit&&f.value.push(e)}function $(e){const l=e?[e.id]:f.value.map((e=>e.id));n.confirm("此操作将删除文件, 是否继续?","提示",{type:"warning"}).then((()=>{i.success("删除成功"),l.forEach((e=>{[P.value,f.value].forEach((l=>{const a=l.findIndex((l=>l.id===e));l.splice(a,1)}))})),o.space.info.delete({ids:l}).catch((e=>{i.error(e.message)}))})).catch((()=>null))}function A(){P.value.length&&P.value.length<z.total&&S({page:z.page+1})}function J(e){e.preventDefault()}function B(e){e.preventDefault(),e.dataTransfer.files.forEach(((e,l)=>{setTimeout((()=>{d.value.upload(e)}),10*l)}))}return D(f,(e=>{a("selection-change",e)}),{deep:!0}),F("space",{selection:f,refresh:S,loading:m,list:P}),l({selection:f,open:open,close:close,clear:G,refresh:S}),(l,a)=>{const s=y("el-button"),i=y("cl-upload"),n=y("el-icon"),o=y("el-scrollbar"),r=y("cl-view-group"),c=V("infinite-scroll"),z=V("loading");return _(),g("div",{class:"cl-upload-panel",onDragover:J,onDrop:B},[k(r,{ref_key:"ViewGroup",ref:p,title:"全部文件"},{left:b((()=>[k(X)])),right:b((()=>[h("div",{class:"cl-upload-panel__right",ref_key:"Content",ref:v},[h("div",de,[k(s,{onClick:a[0]||(a[0]=e=>S({page:1}))},{default:b((()=>[x("刷新")])),_:1}),h("div",ve,[k(i,{ref_key:"Upload",ref:d,type:"file","show-file-list":!1,limit:e.limit,"limit-upload":!1,accept:e.accept,multiple:"",onSuccess:K,onUpload:L},{default:b((()=>[k(s,{type:"primary"},{default:b((()=>[x("点击上传")])),_:1})])),_:1},8,["limit","accept"])]),e.selectable?I("",!0):(_(),C(s,{key:0,type:"danger",disabled:0==f.value.length,onClick:a[1]||(a[1]=e=>$())},{default:b((()=>[x("删除选中文件")])),_:1},8,["disabled"]))]),E((_(),C(o,{class:"cl-upload-panel__file"},{default:b((()=>[E((_(),g("div",me,[P.value.length>0?(_(),g("div",{key:0,class:q(["list",{"is-mini":O(u).isMini}])},[(_(!0),g(j,null,w(P.value,(e=>(_(),g("div",{class:"item",key:e.preload||e.url},[k(pe,{data:e,list:P.value,onSelect:U,onRemove:$},null,8,["data","list"])])))),128))],2)):(_(),g("div",fe,[k(n,{class:"el-icon--upload"},{default:b((()=>[k(O(t))])),_:1}),ye]))])),[[c,A]])])),_:1})),[[z,m.value]])],512)])),_:1},512)],32)}}});export{ge as _};
