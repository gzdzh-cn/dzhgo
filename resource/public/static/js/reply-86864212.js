import{i as e}from"./index.umd.min-ead3793b.js";import{u as o}from"./browser-f4ca2ed3.js";import"./vue-echarts-bffdbdc9.js";import"./element-plus-e665fdbc.js";import"./store-acbd10e3.js";import"./index-ecdd2562.js";import{u as r}from"./index-1fe6d5c5.js";import{d as l,W as t,o as i,I as s,J as a,a as p,b as d}from"./@vue.runtime-core-6173334e.js";import{r as m,u as n}from"./@vue.reactivity-54707199.js";import"./axios-bb93cf32.js";import"./vue-21f38777.js";import"./@vue.runtime-dom-532828a1.js";import"./@vue.shared-0cc4c744.js";import"./monaco-editor-c28fb00f.js";import"./nprogress-27d9be10.js";import"./lodash-es-fd5b777b.js";import"./vue-router-25454f45.js";import"./@vueuse.core-cb7ad152.js";import"./@vueuse.shared-feb01f08.js";import"./pinia-77f7f468.js";import"./vue-demi-71ba0ef2.js";import"./mockjs-005b47e8.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@element-plus.icons-vue-e9c91902.js";import"./@popperjs.core-b696b006.js";import"./@ctrl.tinycolor-a951068a.js";import"./dayjs-f8876307.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";const u={style:{padding:"10px 10px 0px 20px",display:"flex","flex-wrap":"wrap","row-gap":"10px"}},c=p("div",{class:"divider"},null,-1),v=l({name:"crm-reply"}),j=l({...v,setup(l){var v;const{service:j}=r(),{user:f}=o(),y=m(1!=(null==(v=f.info)?void 0:v.id)),b=e.useUpsert({items:[()=>({label:"会员",prop:"uid",span:12,required:!0,hidden:()=>1!=f.info.id,component:{name:"el-select",props:{}}}),{label:"标题",prop:"title",required:!0,component:{name:"el-input"}},{label:"跟踪订单",prop:"historyId",component:{name:"slot-historyId"}},{label:"图片上传",prop:"imgs",component:{name:"cl-upload",props:{type:"image",multiple:!0,showFileList:!0,draggable:!0,rename:!1}}},{label:"文件上传",prop:"files",component:{name:"cl-upload",props:{type:"file",multiple:!0,showFileList:!0,draggable:!0,rename:!1}}},{label:"备注",prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:4}}}],async onOpen(e){var o,r,l,t;if(1==f.info.id){const e=await j.base.sys.user.list();null==(o=b.value)||o.setOptions("uid",e.map((e=>({label:e.nickName||"",value:e.id||""})))),"add"==(null==(r=b.value)?void 0:r.mode)&&(null==(l=b.value)||l.setForm("uid",f.info.id))}"update"==(null==(t=b.value)?void 0:t.mode)&&await k(e.orderCode)},async onSubmit(e,{next:o}){var r;let l={orderId:x.value[e.historyId].orderId,projectNum:x.value[e.historyId].projectNum,orderCode:x.value[e.historyId].orderCode};1!=(null==(r=f.info)?void 0:r.id)&&(l.uid=f.info.id),o({...e,...l})}}),h=e.useTable({columns:[{type:"selection"},{label:"会员",prop:"userName",hidden:y},{label:"标题",prop:"title"},{label:"备注",prop:"remark",showOverflowTooltip:!0,minWidth:150},{label:"创建时间",prop:"createTime",component:{name:"cl-date-text",props:{format:"YYYY-MM-DD"}}},{type:"op",buttons:["edit","delete"]}]}),g=e.useCrud({service:j.crm.reply},(e=>{e.refresh()})),x=m({}),w=m([]),I=m(!1),k=async e=>{if(""!==e){I.value=!0;const o=await j.crm.dohistory.list({keyWord:e});x.value={},I.value=!1,w.value=o.map((e=>(x.value[e.id]=e,{label:e.title+"-"+e.orderCode,value:e.id})))}},C=m(),_=e=>{C.value=e};return(e,o)=>{const r=t("cl-refresh-btn"),l=t("cl-add-btn"),m=t("cl-multi-delete-btn"),v=t("cl-search-key"),j=t("cl-flex1"),f=t("cl-table"),y=t("cl-row"),x=t("cl-pagination"),C=t("el-select-v2"),z=t("cl-upsert"),F=t("cl-crud");return i(),s(F,{ref_key:"Crud",ref:g},{default:a((()=>[p("div",u,[d(r),d(l),d(m,{style:{"margin-right":"10px"}}),d(v),d(j)]),c,d(y,null,{default:a((()=>[d(f,{ref_key:"Table",ref:h,border:!1},null,512)])),_:1}),d(y,null,{default:a((()=>[d(j),d(x)])),_:1}),d(z,{ref_key:"Upsert",ref:b},{"slot-historyId":a((({scope:e})=>{var o;return[d(C,{modelValue:e.historyId,"onUpdate:modelValue":o=>e.historyId=o,filterable:"",remote:"","remote-method":k,onChange:_,clearable:"",options:w.value,loading:I.value,placeholder:"请输入跟踪订单",disabled:"add"!=(null==(o=n(b))?void 0:o.mode)},null,8,["modelValue","onUpdate:modelValue","options","loading","disabled"])]})),_:1},512)])),_:1},512)}}});export{j as default};
