import{u as e}from"./component-643e0931.js";import{i as t}from"./index.umd.min-ead3793b.js";import{d as l}from"./browser-f4ca2ed3.js";import"./vue-echarts-bffdbdc9.js";import{a,c as n}from"./element-plus-e665fdbc.js";import"./store-acbd10e3.js";import{a as o,r}from"./index-ecdd2562.js";import{u as s}from"./index-1fe6d5c5.js";import{v as i,w as p}from"./@vue.runtime-dom-532828a1.js";import{B as c,V as d,E as u}from"./@element-plus.icons-vue-e9c91902.js";import{r as m}from"./lodash-es-fd5b777b.js";import{d as v,e as f,W as b,_ as h,o as j,c as _,a as y,b as g,J as k,K as w,N as x,I as C,M as I,al as N,ak as T}from"./@vue.runtime-core-6173334e.js";import{r as z,u as V}from"./@vue.reactivity-54707199.js";import{p as $,L as B}from"./@vue.shared-0cc4c744.js";import{_ as q}from"./_plugin-vue_export-helper-1b428a4d.js";import"./axios-bb93cf32.js";import"./vue-21f38777.js";import"./monaco-editor-c28fb00f.js";import"./nprogress-27d9be10.js";import"./vue-router-25454f45.js";import"./@vueuse.core-cb7ad152.js";import"./@vueuse.shared-feb01f08.js";import"./pinia-77f7f468.js";import"./vue-demi-71ba0ef2.js";import"./mockjs-005b47e8.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@popperjs.core-b696b006.js";import"./@ctrl.tinycolor-a951068a.js";import"./dayjs-f8876307.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";const G={class:"dept-tree"},E={class:"dept-tree__header"},F=(e=>(N("data-v-bb72c39a"),e=e(),T(),e))((()=>y("div",null,"栏目类别",-1))),K={class:"dept-tree__op"},L={class:"no"},M=["onContextmenu"],J={class:"dept-tree__node"},U=["onClick"],W=["onClick"],A=v({name:"content-tree"}),D=q(v({...A,props:{drag:{type:Boolean,default:!0},level:{type:Number,default:99}},emits:["list-change","refresh","user-add"],setup(v,{emit:N}){const T=v,{service:q,browser:A}=s(),{ViewGroup:D}=e(),O=t.useForm(),P=z([]),R=z(!1),S=z(!1);function H({data:e}){return e.parentId}function Q(e,t){return t.data.parentId}async function X(){R.value=!0,S.value=!1,await q.cms.contentType.list().then((e=>{var t;P.value=o(e),(null==(t=D.value)?void 0:t.selected)||Y()})),R.value=!1}function Y(e){var t,l;if(e||(e=P.value[0]),e){const a=e.children?r(e.children).map((e=>e.id)):[];a.unshift(e.id),N("refresh",{page:1,typeIds:a}),null==(t=D.value)||t.select(e),null==(l=D.value)||l.setTitle(`列表-${e.name}`)}}function Z(e){var t;const l=e.id?"update":"add",n=e.id?"编辑":"新增";null==(t=O.value)||t.open({title:n,width:"550px",props:{labelWidth:"100px"},items:[{label:"类别",prop:"name",component:{name:"el-input"},required:!0},{label:"模型",prop:"modelId",required:!0,component:{name:"el-select",options:[],props:{clearable:!0,placeholder:"请选择模型"}}},{label:"排序",prop:"orderNum",value:99,component:{name:"el-input-number",props:{"controls-position":"right",min:0,max:100}}}],form:{...e},on:{open(){q.cms.model.list().then((e=>{var t;null==(t=O.value)||t.setOptions("modelId",e.map((e=>({label:e.name,value:e.id}))))}))},submit(t,{done:o,close:r}){q.cms.contentType[l]({id:e.id,parentId:e.parentId,name:t.name,orderNum:t.orderNum,modelId:t.modelId}).then((()=>{a.success(`${n} ${t.name} 成功`),r(),X()})).catch((e=>{a.error(e.message),o()}))}}})}function ee(e){n.confirm(`该操作会删除 “${e.name}” 类别下所有数据，是否确认？`,"提示",{type:"warning",confirmButtonText:"直接删除",cancelButtonText:"取消",distinguishCancelAndClose:!0}).then((()=>{!async function(t){await q.cms.contentType.delete({ids:[e.id],deletePro:t}).then((()=>{var l,o;(null==(o=null==(l=D.value)?void 0:l.selected)?void 0:o.id)==e.id&&Y(),t?a.success("删除成功"):n.confirm(`“${e.name}” 部门的用户已成功转移到 “${e.parentName}” 部门。`,"删除成功")})),X()}(!0)})).catch((e=>{}))}function te(e){e?n.confirm("已发生改变，是否保存？","提示",{type:"warning"}).then((async()=>{const e=[];!function t(l,a){l.forEach((l=>{l.parentId=a,e.push(l),l.children&&m(l.children)&&t(l.children,l.id)}))}(P.value,null),await q.base.sys.department.order(e.map(((e,t)=>({id:e.id,parentId:e.parentId,orderNum:t})))).then((()=>{a.success("更新排序成功")})).catch((e=>{a.error(e.message)})),X(),S.value=!1})).catch((()=>null)):X()}function le(e,a,n){a||(a=P.value[0]||{});const o=q.cms.contentType.permission;t.ContextMenu.open(e,{list:[{label:"新增",hidden:n&&n.level>=T.level||!l(o.add),callback(e){Z({title:""}),e()}},{label:"编辑",hidden:!l(o.update),callback(e){Z(a),e()}},{label:"删除",hidden:!l(o.delete),callback(e){ee(a),e()}}]})}return f((function(){X()})),(e,t)=>{const l=b("el-icon"),a=b("el-tooltip"),n=b("el-button"),o=b("el-tree"),r=b("el-scrollbar"),s=b("cl-form"),m=h("loading");return j(),_("div",G,[y("div",E,[F,y("ul",K,[y("li",{onClick:t[0]||(t[0]=e=>Z({name:""}))},[g(a,{content:"新增"},{default:k((()=>[g(l,null,{default:k((()=>[g(V(c))])),_:1})])),_:1})]),y("li",{onClick:t[1]||(t[1]=e=>X())},[g(a,{content:"刷新"},{default:k((()=>[g(l,null,{default:k((()=>[g(V(d))])),_:1})])),_:1})]),w(y("li",L,[g(n,{onClick:t[2]||(t[2]=e=>te(!0)),size:"small"},{default:k((()=>[x("保存")])),_:1}),g(n,{onClick:t[3]||(t[3]=e=>te(!1)),size:"small"},{default:k((()=>[x("取消")])),_:1})],512),[[i,S.value]])])]),y("div",{class:"dept-tree__container",onContextmenu:p(le,["stop","prevent"])},[g(r,null,{default:k((()=>[w((j(),C(o,{"node-key":"id","default-expand-all":"",data:P.value,props:{label:"name"},draggable:S.value,"allow-drag":H,"allow-drop":Q,"expand-on-click-node":!1,onNodeContextmenu:le},{default:k((({node:e,data:t})=>{var a,n;return[y("div",J,[y("span",{class:$(["dept-tree__node-label",{"is-active":t.id==(null==(n=null==(a=V(D))?void 0:a.selected)?void 0:n.id)}]),onClick:e=>Y(t)},B(e.label),11,U),V(A).isMini?(j(),_("span",{key:0,class:"dept-tree__node-icon",onClick:l=>le(l,t,e)},[g(l,null,{default:k((()=>[g(V(u))])),_:1})],8,W)):I("",!0)])]})),_:1},8,["data","draggable"])),[[m,R.value]])])),_:1})],40,M),g(s,{ref_key:"Form",ref:O},null,512)])}}}),[["__scopeId","data-v-bb72c39a"]]),O=v({name:"cms-content"}),P=v({...O,setup(l){const{service:a}=s(),{ViewGroup:n}=e(),o=t.useUpsert({items:[{label:"名称",prop:"name",required:!0,component:{name:"el-input"}},{label:"图片",prop:"img",component:{name:"cl-upload"}},{label:"点击量",prop:"click",value:0,component:{name:"el-input-number",props:{min:0}}},{label:"内容",prop:"content",component:{name:"cl-editor-wang"}},{label:"状态",prop:"status",value:1,component:{name:"el-switch",props:{activeValue:1,inactiveValue:0}}}],onSubmit(e,{next:t}){var l,a;t({...e,typeId:null==(a=null==(l=n.value)?void 0:l.selected)?void 0:a.id})}}),r=t.useTable({columns:[{type:"selection"},{label:"名称",prop:"name"},{label:"点击量",prop:"click"},{label:"排序",prop:"orderNum"},{label:"创建时间",prop:"createTime"},{type:"op",buttons:["edit","delete"]}]}),i=t.useCrud({service:a.cms.content});function p(e){var t;null==(t=i.value)||t.refresh(e)}return(e,t)=>{const l=b("cl-refresh-btn"),a=b("cl-add-btn"),s=b("cl-multi-delete-btn"),c=b("cl-flex1"),d=b("cl-search-key"),u=b("cl-row"),m=b("cl-table"),v=b("cl-pagination"),f=b("cl-upsert"),h=b("cl-crud"),_=b("cl-view-group");return j(),C(_,{ref_key:"ViewGroup",ref:n},{left:k((()=>[g(D,{onRefresh:p})])),right:k((()=>[g(h,{ref_key:"Crud",ref:i},{default:k((()=>[g(u,null,{default:k((()=>[g(l),g(a),g(s),g(c),g(d)])),_:1}),g(u,null,{default:k((()=>[g(m,{ref_key:"Table",ref:r},null,512)])),_:1}),g(u,null,{default:k((()=>[g(c),g(v)])),_:1}),g(f,{ref_key:"Upsert",ref:o},null,512)])),_:1},512)])),_:1},512)}}});export{P as default};
