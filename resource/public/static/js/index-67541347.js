import{d as e}from"./dayjs-f8876307.js";import{h as a,u as s,m as l,b as t}from"./browser-f4ca2ed3.js";import"./vue-echarts-bffdbdc9.js";import"./element-plus-e665fdbc.js";import"./store-acbd10e3.js";import"./index-ecdd2562.js";import{u as i}from"./index-1fe6d5c5.js";import{J as n,a7 as o,a8 as c,V as r,a9 as u,aa as d,m}from"./@element-plus.icons-vue-e9c91902.js";import{y as v,d as p,q as f,W as h,_ as g,K as j,o as _,c as y,a as x,F as k,b,M as w,U as z,J as C,N as M,I as T,n as V,z as I}from"./@vue.runtime-core-6173334e.js";import{d as N}from"./pinia-77f7f468.js";import{r as U,u as q}from"./@vue.reactivity-54707199.js";import{i as S}from"./index.umd.min-ead3793b.js";import{i as B}from"./@vueuse.core-cb7ad152.js";import{L as J,p as Y}from"./@vue.shared-0cc4c744.js";import{_ as D}from"./_plugin-vue_export-helper-1b428a4d.js";import{d as K}from"./lodash-es-fd5b777b.js";import"./axios-bb93cf32.js";import"./monaco-editor-c28fb00f.js";import"./nprogress-27d9be10.js";import"./vue-router-25454f45.js";import"./mockjs-005b47e8.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@vueuse.shared-feb01f08.js";import"./@vue.runtime-dom-532828a1.js";import"./@popperjs.core-b696b006.js";import"./@ctrl.tinycolor-a951068a.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";import"./vue-demi-71ba0ef2.js";import"./vue-21f38777.js";function L(){return{chat:v("chat")}}const F=N("chat-message",(()=>{const e=U(!1),s=U([]),l=U({page:1,total:0,size:20});return{loading:e,list:s,pagination:l,get:async function(t){e.value=!0,1==(null==t?void 0:t.page)&&(s.value=[]),await a.chat.message.page(t).then((e=>{s.value=e.list.map((e=>(e.content=JSON.parse(e.content),e))),l.value=e.pagination})),e.value=!1}}})),H=N("chat-session",(()=>{const e=U(!1),s=U([]),l=U();function t(e){l.value=e}return{loading:e,list:s,value:l,get:async function(i){e.value=!0,await a.chat.session.page(i).then((e=>{l.value||t(e.list[0]),s.value=e.list})),e.value=!1},set:t}}));function R(){return{session:H(),message:F()}}const E={class:"chat-message","element-loading-text":"消息列表加载中"},G={class:"head"},O={class:"avatar"},W={class:"name"},A={class:"list scroller1"},P={class:"avatar"},Q=["onContextmenu"],X={class:"h"},Z={class:"name"},$={class:"content"},ee={key:0,class:"is-text"},ae={key:1,class:"is-image"},se={class:"footer"},le={class:"tools"},te={class:"input"},ie=p({name:"undefined"}),ne=D(p({...ie,setup(e){const{user:a}=s(),{chat:l}=L(),{message:t,session:i}=R(),{copy:r}=B(),u=U(""),d=f((()=>{let e=0;return t.list.map((s=>{var l;return 1==s.contentType&&(s._index=e++),s.isMy=s.fromId==(null==(l=a.info)?void 0:l.id),s}))})),m=f((()=>t.list.filter((e=>1==e.contentType)).map((e=>{var a;return null==(a=e.content)?void 0:a.imageUrl})).filter(Boolean)));function v(){l.send({contentType:0,content:{text:u.value}},!0),u.value=""}function p(e){l.send({contentType:1,content:{imageUrl:e.url}},!0),u.value=""}return(e,a)=>{var s,l,f,T;const V=h("el-avatar"),I=h("el-image"),N=h("el-icon"),U=h("cl-upload"),B=h("el-input"),D=h("el-button"),K=g("loading");return j((_(),y("div",E,[x("div",G,[(null==(s=q(i))?void 0:s.value)?(_(),y(k,{key:0},[x("div",O,[b(V,{size:30,shape:"square",src:null==(l=q(i))?void 0:l.value.avatar},null,8,["src"])]),x("span",W,"与“"+J(null==(f=q(i))?void 0:f.value.nickName)+"”聊天中",1)],64)):w("",!0)]),x("div",A,[x("ul",null,[(_(!0),y(k,null,z(q(d),((e,a)=>(_(),y("li",{key:a},[x("div",{class:Y(["item",{"is-right":e.isMy}])},[x("div",P,[b(V,{size:36,shape:"square",src:e.avatar},null,8,["src"])]),x("div",{class:"det",onContextmenu:a=>{!function(e,a){S.ContextMenu.open(e,{hover:{target:"content"},list:[{label:"复制",callback(e){r(a.content.text||""),e()}},{label:"转发"},{label:"删除"}]})}(a,e)}},[x("div",X,[x("span",Z,J(e.nickName),1)]),x("div",$,[0==e.contentType?(_(),y("div",ee,[x("span",null,J(e.content.text),1)])):1==e.contentType?(_(),y("div",ae,[b(I,{src:e.content.imageUrl,"preview-src-list":q(m),"initial-index":e._index,"scroll-container":".chat-message .list"},null,8,["src","preview-src-list","initial-index"])])):w("",!0)])],40,Q)],2)])))),128))])]),x("div",se,[x("div",le,[x("ul",null,[b(U,{onSuccess:p,"show-file-list":!1},{default:C((()=>[x("li",null,[b(N,null,{default:C((()=>[b(q(n))])),_:1})])])),_:1}),x("li",null,[b(N,null,{default:C((()=>[b(q(o))])),_:1})]),x("li",null,[b(N,null,{default:C((()=>[b(q(c))])),_:1})])])]),x("div",te,[b(B,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),type:"textarea",rows:4,resize:"none",autosize:{minRows:4,maxRows:10},placeholder:"输入内容"},null,8,["modelValue"]),b(D,{size:"small",type:"success",onClick:v,disabled:!u.value},{default:C((()=>[M("发送")])),_:1},8,["disabled"])])])])),[[K,null==(T=q(t))?void 0:T.loading]])}}}),[["__scopeId","data-v-29a48b6e"]]),oe={class:"chat-session"},ce={class:"head"},re={class:"tools"},ue={class:"list"},de=["onClick"],me={class:"avatar"},ve={class:"det"},pe={class:"name"},fe={class:"message"},he={class:"status"},ge={class:"date"},je=p({name:"undefined"}),_e=D(p({...je,setup(e){const{chat:a}=L(),{session:s,message:l}=R(),t=U(""),i=f((()=>(null==s?void 0:s.list.filter((e=>{var a;return null==(a=e.nickName)?void 0:a.includes(t.value)})))||[]));return(e,n)=>{var o;const c=h("el-input"),u=h("el-icon"),d=h("el-avatar"),m=h("el-badge"),v=h("el-empty"),p=h("el-scrollbar"),f=g("loading");return _(),y("div",oe,[x("div",ce,[b(c,{modelValue:t.value,"onUpdate:modelValue":n[0]||(n[0]=e=>t.value=e),placeholder:"关键字搜索",clearable:""},null,8,["modelValue"]),x("ul",re,[x("li",{onClick:n[1]||(n[1]=e=>q(s).get())},[b(u,{size:16},{default:C((()=>[b(q(r))])),_:1})])])]),j((_(),y("div",ue,[b(p,{class:"scroller"},{default:C((()=>[(_(!0),y(k,null,z(q(i),((e,t)=>{var i,n;return _(),y("div",{class:Y(["item",{"is-active":e.id==(null==(n=null==(i=q(s))?void 0:i.value)?void 0:n.id)}]),key:t,onClick:t=>async function(e){a.expand(!1),s.set(e),await l.get({page:1}),a.scrollToBottom()}(e)},[x("div",me,[b(m,{value:e.num,hidden:0==e.num},{default:C((()=>[b(d,{shape:"square",src:e.avatar},null,8,["src"])])),_:2},1032,["value","hidden"])]),x("div",ve,[x("p",pe,J(e.nickName),1),x("p",fe,J(e.text),1)]),x("div",he,[x("p",ge,J(e.createTime),1)])],10,de)})),128)),0==q(i).length?(_(),T(v,{key:0,"image-size":100,description:"暂无会话"})):w("",!0)])),_:1})])),[[f,null==(o=q(s))?void 0:o.loading]])])}}}),[["__scopeId","data-v-f1175bed"]]),ye={class:"cl-chat__wrap"},xe={class:"cl-chat__session"},ke={class:"cl-chat__right"},be={class:"cl-dialog__controls-icon"},we=p({name:"cl-chat"}),ze=p({...we,setup(a,{expose:n}){i();const{browser:o,onScreenChange:c}=t(),{session:r,message:v}=R(),{user:p}=s();l.get("chat");const f=U(!1),g=U(!0),j=U(parseInt(String(100*Math.random())));function k(){!async function(){await r.get(),await v.get(),M()}()}function w(){f.value=!0,k()}function z(a){var s,l,t,i;v.list.push({fromId:null==(s=p.info)?void 0:s.id,toId:null==(l=r.value)?void 0:l.userId,avatar:null==(t=p.info)?void 0:t.headImg,nickName:null==(i=p.info)?void 0:i.nickName,createTime:e().format("YYYY-MM-DD HH:mm:ss"),...a}),M()}const M=K((()=>{V((()=>{const e=document.querySelector(".cl-chat .chat-message .list");null==e||e.scroll({top:1e5+Math.random(),behavior:"smooth"})}))}),300);return I("chat",{get socket(){},send:function(e,a){a&&z(e)},append:z,expand:function(e){g.value=void 0===e?!g.value:e},scrollToBottom:M}),c((()=>{g.value=!o.isMini})),n({open:w,close:function(){f.value=!1}}),(e,a)=>{const s=h("el-icon"),l=h("el-badge"),t=h("cl-dialog");return _(),y("div",ye,[x("div",{class:"cl-chat__icon",onClick:w},[b(l,{value:j.value},{default:C((()=>[b(s,{size:15},{default:C((()=>[b(q(u))])),_:1})])),_:1},8,["value"])]),b(t,{modelValue:f.value,"onUpdate:modelValue":a[2]||(a[2]=e=>f.value=e),title:"聊天窗口",height:"630px",width:"1200px","keep-alive":"","close-on-click-modal":!1,"close-on-press-escape":"","append-to-body":"",controls:["slot-expand","cl-flex1","fullscreen","close"]},{"slot-expand":C((()=>[x("button",be,[g.value?(_(),T(s,{key:1,onClick:a[1]||(a[1]=e=>g.value=!1)},{default:C((()=>[b(q(m))])),_:1})):(_(),T(s,{key:0,onClick:a[0]||(a[0]=e=>g.value=!0)},{default:C((()=>[b(q(d))])),_:1}))])])),default:C((()=>[x("div",{class:Y(["cl-chat",{"is-mini":q(o).isMini,"is-expand":g.value}])},[x("div",xe,[b(_e)]),x("div",ke,[b(ne)])],2)])),_:1},8,["modelValue"])])}}});export{ze as default};
