import{i as e}from"./index.umd.min-ead3793b.js";import{d as l,u as a}from"./browser-f4ca2ed3.js";import"./vue-echarts-bffdbdc9.js";import{a as t,c as n}from"./element-plus-e665fdbc.js";import"./store-acbd10e3.js";import{a as r,r as o}from"./index-ecdd2562.js";import{u as s}from"./index-1fe6d5c5.js";import{u as i}from"./component-643e0931.js";import{d as p,p as d,e as u,W as m,o as c,c as v,b as f,_ as h,a as b,J as y,M as k,K as _,N as j,I as g,al as w,ak as x,U as C,F as I}from"./@vue.runtime-core-6173334e.js";import{r as N,u as W}from"./@vue.reactivity-54707199.js";import{_ as V}from"./_plugin-vue_export-helper-1b428a4d.js";import{v as z,w as q}from"./@vue.runtime-dom-532828a1.js";import{V as B,W as F,E as M}from"./@element-plus.icons-vue-e9c91902.js";import{r as T}from"./lodash-es-fd5b777b.js";import{p as U,L as A}from"./@vue.shared-0cc4c744.js";import"./axios-bb93cf32.js";import"./vue-21f38777.js";import"./monaco-editor-c28fb00f.js";import"./nprogress-27d9be10.js";import"./vue-router-25454f45.js";import"./@vueuse.core-cb7ad152.js";import"./@vueuse.shared-feb01f08.js";import"./pinia-77f7f468.js";import"./vue-demi-71ba0ef2.js";import"./mockjs-005b47e8.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@popperjs.core-b696b006.js";import"./@ctrl.tinycolor-a951068a.js";import"./dayjs-f8876307.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";const L={class:"dept-select"},$=p({name:"dept-select"}),G=V(p({...$,props:{modelValue:[Array,Number,String],multiple:Boolean,checkStrictly:{type:Boolean,default:!0}},emits:["update:modelValue","change"],setup(e,{emit:l}){const a=e,{service:n}=s(),o=N(),i=N();function p(e){a.multiple||l("update:modelValue",e)}function h(e,{checkedKeys:t}){a.multiple&&l("update:modelValue",t)}return d((()=>a.modelValue),(e=>{o.value=e}),{immediate:!0}),u((()=>{n.base.sys.department.list().then((e=>{i.value=r(e)})).catch((e=>{i.value=[],t.error(e.message)}))})),(l,a)=>{const t=m("el-tree-select");return c(),v("div",L,[f(t,{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e),"node-key":"id",data:i.value,props:{label:"name",value:"id",children:"children"},multiple:e.multiple,"check-strictly":e.checkStrictly,"show-checkbox":e.multiple,"default-expand-all":"",onChange:p,onCheck:h},null,8,["modelValue","data","multiple","check-strictly","show-checkbox"])])}}}),[["__scopeId","data-v-6be59c9b"]]),K={class:"dept-move"},S=p({name:"dept-move"}),E=p({...S,setup(l,{expose:a}){const{service:r}=s(),o=e.useForm(),i=e.useCrud();return a({open:async function(e){var l;null==(l=o.value)||l.open({title:"部门转移",width:"500px",props:{labelWidth:"80px"},items:[{label:"选择部门",prop:"departmentId",component:{vm:G}}],on:{submit(l,{done:a,close:o}){if(!l.departmentId)return t.warning("请选择部门"),a();n.confirm("转移到新部门，是否继续？","提示",{type:"warning"}).then((()=>{r.base.sys.user.move({...l,userIds:e}).then((()=>{var e;t.success("转移成功"),null==(e=i.value)||e.refresh(),o()})).catch((e=>{t.error(e.message),a()}))})).catch((()=>null))}}})}}),(e,l)=>{const a=m("cl-form");return c(),v("div",K,[f(a,{ref_key:"Form",ref:o},null,512)])}}}),J={class:"dept-tree"},O={class:"dept-tree__header"},R=(e=>(w("data-v-03398b69"),e=e(),x(),e))((()=>b("div",null,"组织架构",-1))),D={class:"dept-tree__op"},H={class:"no"},P=["onContextmenu"],Q={class:"dept-tree__node"},X=["onClick"],Y=["onClick"],Z=p({name:"dept-tree"}),ee=V(p({...Z,props:{drag:{type:Boolean,default:!0},level:{type:Number,default:99}},emits:["list-change","refresh","user-add"],setup(a,{emit:p}){const d=a,{service:w,browser:x}=s(),{ViewGroup:C}=i(),I=e.useForm(),V=N([]),L=N(!1),$=N(!1);function G({data:e}){return e.parentId}function K(e,l){return l.data.parentId}async function S(){L.value=!0,$.value=!1,await w.base.sys.department.list().then((e=>{var l;V.value=r(e),(null==(l=C.value)?void 0:l.selected)||E()})),L.value=!1}function E(e){var l,a;if(e||(e=V.value[0]),e){const t=e.children?o(e.children).map((e=>e.id)):[];t.unshift(e.id),p("refresh",{page:1,departmentIds:t}),null==(l=C.value)||l.select(e),null==(a=C.value)||a.setTitle(`成员列表（${e.name})`)}}function Z(e){var l;const a=e.id?"update":"add";null==(l=I.value)||l.open({title:"编辑部门",width:"550px",props:{labelWidth:"100px"},items:[{label:"部门名称",prop:"name",component:{name:"el-input"},required:!0},{label:"上级部门",prop:"parentName",component:{name:"el-input",props:{disabled:!0}}},{label:"排序",prop:"orderNum",component:{name:"el-input-number",props:{"controls-position":"right",min:0,max:100}}}],form:{...e},on:{submit(l,{done:n,close:r}){w.base.sys.department[a]({id:e.id,parentId:e.parentId,name:l.name,orderNum:l.orderNum}).then((()=>{t.success(`新增部门 “${l.name}” 成功`),r(),S()})).catch((e=>{t.error(e.message),n()}))}}})}function ee(e){e?n.confirm("部门架构已发生改变，是否保存？","提示",{type:"warning"}).then((async()=>{const e=[];!function l(a,t){a.forEach((a=>{a.parentId=t,e.push(a),a.children&&T(a.children)&&l(a.children,a.id)}))}(V.value,null),await w.base.sys.department.order(e.map(((e,l)=>({id:e.id,parentId:e.parentId,orderNum:l})))).then((()=>{t.success("更新排序成功")})).catch((e=>{t.error(e.message)})),S(),$.value=!1})).catch((()=>null)):S()}function le(a,r,o){r||(r=V.value[0]||{});const s=w.base.sys.department.permission;e.ContextMenu.open(a,{list:[{label:"新增",hidden:o&&o.level>=d.level||!l(s.add),callback(e){Z({name:"",parentName:r.name,parentId:r.id}),e()}},{label:"编辑",hidden:!l(s.update),callback(e){Z(r),e()}},{label:"删除",hidden:!r.parentId||!l(s.delete),callback(e){!function(e){async function l(l){await w.base.sys.department.delete({ids:[e.id],deleteUser:l}).then((()=>{var a,r;(null==(r=null==(a=C.value)?void 0:a.selected)?void 0:r.id)==e.id&&E(),l?t.success("删除成功"):n.confirm(`“${e.name}” 部门的用户已成功转移到 “${e.parentName}” 部门。`,"删除成功")})),S()}n.confirm(`该操作会删除 “${e.name}” 部门的所有用户，是否确认？`,"提示",{type:"warning",confirmButtonText:"直接删除",cancelButtonText:"保留用户",distinguishCancelAndClose:!0}).then((()=>{l(!0)})).catch((e=>{"cancel"==e&&l(!1)}))}(r),e()}},{label:"新增成员",hidden:!l(s.add),callback(e){p("user-add",r),e()}}]})}return u((function(){S()})),(e,l)=>{const t=m("el-icon"),n=m("el-tooltip"),r=m("el-button"),o=m("el-tree"),s=m("el-scrollbar"),i=m("cl-form"),p=h("loading");return c(),v("div",J,[b("div",O,[R,b("ul",D,[b("li",{onClick:l[0]||(l[0]=e=>S())},[f(n,{content:"刷新"},{default:y((()=>[f(t,null,{default:y((()=>[f(W(B))])),_:1})])),_:1})]),a.drag&&!W(x).isMini?(c(),v("li",{key:0,onClick:l[1]||(l[1]=e=>$.value=!0)},[f(n,{content:"拖动排序"},{default:y((()=>[f(t,null,{default:y((()=>[f(W(F))])),_:1})])),_:1})])):k("",!0),_(b("li",H,[f(r,{onClick:l[2]||(l[2]=e=>ee(!0)),size:"small"},{default:y((()=>[j("保存")])),_:1}),f(r,{onClick:l[3]||(l[3]=e=>ee(!1)),size:"small"},{default:y((()=>[j("取消")])),_:1})],512),[[z,$.value]])])]),b("div",{class:"dept-tree__container",onContextmenu:q(le,["stop","prevent"])},[f(s,null,{default:y((()=>[_((c(),g(o,{"node-key":"id","default-expand-all":"",data:V.value,props:{label:"name"},draggable:$.value,"allow-drag":G,"allow-drop":K,"expand-on-click-node":!1,onNodeContextmenu:le},{default:y((({node:e,data:l})=>{var a,n;return[b("div",Q,[b("span",{class:U(["dept-tree__node-label",{"is-active":l.id==(null==(n=null==(a=W(C))?void 0:a.selected)?void 0:n.id)}]),onClick:e=>E(l)},A(e.label),11,X),W(x).isMini?(c(),v("span",{key:0,class:"dept-tree__node-icon",onClick:a=>le(a,l,e)},[f(t,null,{default:y((()=>[f(W(M))])),_:1})],8,Y)):k("",!0)])]})),_:1},8,["data","draggable"])),[[p,L.value]])])),_:1})],40,P),f(i,{ref_key:"Form",ref:I},null,512)])}}}),[["__scopeId","data-v-03398b69"]]),le=p({name:"sys-user"}),ae=p({...le,setup(l){const{service:t,refs:n,setRefs:r}=s(),{ViewGroup:o}=i(),{user:p}=a(),d=e.useCrud({service:t.base.sys.user}),u=e.useTable({columns:[{type:"selection",width:60},{prop:"headImg",label:"头像",component:{name:"cl-avatar"}},{prop:"username",label:"用户名",minWidth:150},{prop:"name",label:"姓名",minWidth:150},{prop:"nickName",label:"昵称",minWidth:150},{prop:"departmentName",label:"部门名称",minWidth:150},{prop:"roleName",label:"角色",headerAlign:"center",minWidth:120,formatter(e,l,a,t){var n;return 1==(null==(n=p.info)?void 0:n.id)?"超管":a}},{prop:"status",label:"状态",minWidth:120,component:{name:"cl-switch"}},{prop:"phone",label:"手机号码",minWidth:150},{prop:"remark",label:"备注",minWidth:150},{prop:"createTime",label:"创建时间",sortable:"desc",minWidth:160},{type:"op",buttons:["slot-btn","edit","delete"],width:240}]}),b=e.useUpsert({dialog:{width:"800px"},items:[{prop:"headImg",label:"头像",component:{name:"cl-upload",props:{text:"选择头像"}}},{prop:"name",label:"姓名",span:12,required:!0,component:{name:"el-input"}},{prop:"nickName",label:"昵称",required:!0,span:12,component:{name:"el-input"}},{prop:"username",label:"用户名",required:!0,span:12,component:{name:"el-input"}},()=>{var e;return{prop:"password",label:"密码",span:12,required:"add"==(null==(e=b.value)?void 0:e.mode),component:{name:"el-input",props:{type:"password"}},rules:[{min:6,max:16,message:"密码长度在 6 到 16 个字符"}]}},()=>{var e,l;return{prop:"roleIdList",label:"角色",value:[],required:!0,hidden:1==(null==(e=p.info)?void 0:e.id)&&"add"!==(null==(l=b.value)?void 0:l.mode),component:{name:"el-select",options:[],props:{multiple:!0,"multiple-limit":3}}}},{prop:"phone",label:"手机号码",span:12,component:{name:"el-input"}},{prop:"email",label:"邮箱",span:12,component:{name:"el-input"}},{prop:"remark",label:"备注",component:{name:"el-input",props:{type:"textarea",rows:4}}},{prop:"status",label:"状态",value:1,component:{name:"el-radio-group",options:[{label:"开启",value:1},{label:"关闭",value:0}]}}],onSubmit(e,{next:l}){var a,t;l({...e,departmentId:null==(t=null==(a=o.value)?void 0:a.selected)?void 0:t.id})},async onOpen(){t.base.sys.role.list().then((e=>{var l;null==(l=b.value)||l.setOptions("roleIdList",e.map((e=>({label:e.name||"",value:e.id}))))}))}});function w(e){var l;null==(l=d.value)||l.refresh(e)}function x({id:e}){var l;null==(l=d.value)||l.rowAppend({departmentId:e})}async function N(e){var l;let a=[];a=e?[e.id]:(null==(l=u.value)?void 0:l.selection.map((e=>e.id)))||[],n.deptMove.open(a)}return(e,l)=>{const a=m("cl-refresh-btn"),n=m("cl-add-btn"),s=m("cl-multi-delete-btn"),i=m("el-button"),p=m("cl-flex1"),V=m("cl-search-key"),z=m("cl-row"),q=m("el-tag"),B=m("cl-table"),F=m("cl-pagination"),M=m("cl-upsert"),T=m("cl-crud"),U=m("cl-view-group"),L=h("permission");return c(),g(U,{ref_key:"ViewGroup",ref:o,leftWidth:"20%"},{left:y((()=>[f(ee,{onRefresh:w,onUserAdd:x})])),right:y((()=>[f(T,{ref_key:"Crud",ref:d},{default:y((()=>[f(z,null,{default:y((()=>{var e;return[f(a),f(n),f(s),_((c(),g(i,{type:"success",disabled:0==(null==(e=W(u))?void 0:e.selection.length),onClick:l[0]||(l[0]=e=>N())},{default:y((()=>[j("转移")])),_:1},8,["disabled"])),[[L,W(t).base.sys.user.permission.move]]),f(p),f(V,{placeholder:"搜索用户名、姓名"})]})),_:1}),f(z,null,{default:y((()=>[f(B,{ref_key:"Table",ref:u},{"column-roleName":y((({scope:e})=>[e.row.roleName?(c(!0),v(I,{key:0},C(e.row.roleName.split(","),((e,l)=>(c(),g(q,{key:l,"disable-transitions":"",size:"small",effect:"dark",style:{margin:"2px"}},{default:y((()=>[j(A(e),1)])),_:2},1024)))),128)):k("",!0)])),"slot-btn":y((({scope:e})=>[_((c(),g(i,{text:"",bg:"",onClick:l=>N(e.row)},{default:y((()=>[j("转移")])),_:2},1032,["onClick"])),[[L,W(t).base.sys.user.permission.move]])])),_:1},512)])),_:1}),f(z,null,{default:y((()=>[f(p),f(F)])),_:1}),f(M,{ref_key:"Upsert",ref:b},null,512),f(E,{ref:W(r)("deptMove")},null,512)])),_:1},512)])),_:1},512)}}});export{ae as default};
