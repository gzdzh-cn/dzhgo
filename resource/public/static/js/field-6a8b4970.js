import{u as e}from"./component-643e0931.js";import{i as l}from"./index.umd.min-ead3793b.js";import{d as t}from"./browser-f4ca2ed3.js";import"./vue-echarts-bffdbdc9.js";import{a,c as r}from"./element-plus-e665fdbc.js";import"./store-acbd10e3.js";import{a as n,r as o}from"./index-ecdd2562.js";import{u as s}from"./index-1fe6d5c5.js";import{v as i,w as d}from"./@vue.runtime-dom-532828a1.js";import{B as u,V as p,E as c}from"./@element-plus.icons-vue-e9c91902.js";import{r as m}from"./lodash-es-fd5b777b.js";import{d as f,e as v,W as h,_ as j,o as b,c as _,a as y,b as k,J as g,K as x,N as w,I as C,M as I,al as N,ak as T}from"./@vue.runtime-core-6173334e.js";import{r as z,u as V}from"./@vue.reactivity-54707199.js";import{p as $,L as B}from"./@vue.shared-0cc4c744.js";import{_ as q}from"./_plugin-vue_export-helper-1b428a4d.js";import"./axios-bb93cf32.js";import"./vue-21f38777.js";import"./monaco-editor-c28fb00f.js";import"./nprogress-27d9be10.js";import"./vue-router-25454f45.js";import"./@vueuse.core-cb7ad152.js";import"./@vueuse.shared-feb01f08.js";import"./pinia-77f7f468.js";import"./vue-demi-71ba0ef2.js";import"./mockjs-005b47e8.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@popperjs.core-b696b006.js";import"./@ctrl.tinycolor-a951068a.js";import"./dayjs-f8876307.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";const G={class:"dept-tree"},E={class:"dept-tree__header"},F=(e=>(N("data-v-716fde60"),e=e(),T(),e))((()=>y("div",null,"模型类别",-1))),K={class:"dept-tree__op"},L={class:"no"},M=["onContextmenu"],J={class:"dept-tree__node"},O=["onClick"],U=["onClick"],W=f({name:"model-tree"}),A=q(f({...W,props:{drag:{type:Boolean,default:!0},level:{type:Number,default:99}},emits:["list-change","refresh","user-add"],setup(f,{emit:N}){const T=f,{service:q,browser:W}=s(),{ViewGroup:A}=e(),D=l.useForm(),P=z([]),R=z(!1),S=z(!1);function H({data:e}){return e.parentId}function Q(e,l){return l.data.parentId}async function X(){R.value=!0,S.value=!1,await q.cms.model.list().then((e=>{var l;P.value=n(e),(null==(l=A.value)?void 0:l.selected)||Y()})),R.value=!1}function Y(e){var l,t;if(e||(e=P.value[0]),e){const a=e.children?o(e.children).map((e=>e.id)):[];a.unshift(e.id),N("refresh",{page:1,typeIds:a}),null==(l=A.value)||l.select(e),null==(t=A.value)||t.setTitle(`列表-${e.name}`)}}function Z(e){var l;const t=e.id?"update":"add",r=e.id?"编辑":"新增";null==(l=D.value)||l.open({title:r,width:"550px",props:{labelWidth:"100px"},items:[{label:"类别",prop:"name",component:{name:"el-input"},required:!0},{label:"排序",prop:"orderNum",value:99,component:{name:"el-input-number",props:{"controls-position":"right",min:0,max:100}}}],form:{...e},on:{submit(l,{done:n,close:o}){q.cms.model[t]({id:e.id,parentId:e.parentId,name:l.name,orderNum:l.orderNum}).then((()=>{a.success(`${r} ${l.name} 成功`),o(),X()})).catch((e=>{a.error(e.message),n()}))}}})}function ee(e){r.confirm(`该操作会删除 “${e.name}” 类别下所有数据，是否确认？`,"提示",{type:"warning",confirmButtonText:"直接删除",cancelButtonText:"取消",distinguishCancelAndClose:!0}).then((()=>{!async function(l){await q.cms.model.delete({ids:[e.id],deletePro:l}).then((()=>{var t,n;(null==(n=null==(t=A.value)?void 0:t.selected)?void 0:n.id)==e.id&&Y(),l?a.success("删除成功"):r.confirm(`“${e.name}” 部门的用户已成功转移到 “${e.parentName}” 部门。`,"删除成功")})),X()}(!0)})).catch((e=>{}))}function le(e){e?r.confirm("已发生改变，是否保存？","提示",{type:"warning"}).then((async()=>{const e=[];!function l(t,a){t.forEach((t=>{t.parentId=a,e.push(t),t.children&&m(t.children)&&l(t.children,t.id)}))}(P.value,null),await q.base.sys.department.order(e.map(((e,l)=>({id:e.id,parentId:e.parentId,orderNum:l})))).then((()=>{a.success("更新排序成功")})).catch((e=>{a.error(e.message)})),X(),S.value=!1})).catch((()=>null)):X()}function te(e,a,r){a||(a=P.value[0]||{});const n=q.cms.model.permission;l.ContextMenu.open(e,{list:[{label:"新增",hidden:r&&r.level>=T.level||!t(n.add),callback(e){Z({title:""}),e()}},{label:"编辑",hidden:!t(n.update),callback(e){Z(a),e()}},{label:"删除",hidden:!t(n.delete),callback(e){ee(a),e()}}]})}return v((function(){X()})),(e,l)=>{const t=h("el-icon"),a=h("el-tooltip"),r=h("el-button"),n=h("el-tree"),o=h("el-scrollbar"),s=h("cl-form"),m=j("loading");return b(),_("div",G,[y("div",E,[F,y("ul",K,[y("li",{onClick:l[0]||(l[0]=e=>Z({name:""}))},[k(a,{content:"新增"},{default:g((()=>[k(t,null,{default:g((()=>[k(V(u))])),_:1})])),_:1})]),y("li",{onClick:l[1]||(l[1]=e=>X())},[k(a,{content:"刷新"},{default:g((()=>[k(t,null,{default:g((()=>[k(V(p))])),_:1})])),_:1})]),x(y("li",L,[k(r,{onClick:l[2]||(l[2]=e=>le(!0)),size:"small"},{default:g((()=>[w("保存")])),_:1}),k(r,{onClick:l[3]||(l[3]=e=>le(!1)),size:"small"},{default:g((()=>[w("取消")])),_:1})],512),[[i,S.value]])])]),y("div",{class:"dept-tree__container",onContextmenu:d(te,["stop","prevent"])},[k(o,null,{default:g((()=>[x((b(),C(n,{"node-key":"id","default-expand-all":"",data:P.value,props:{label:"name"},draggable:S.value,"allow-drag":H,"allow-drop":Q,"expand-on-click-node":!1,onNodeContextmenu:te},{default:g((({node:e,data:l})=>{var a,r;return[y("div",J,[y("span",{class:$(["dept-tree__node-label",{"is-active":l.id==(null==(r=null==(a=V(A))?void 0:a.selected)?void 0:r.id)}]),onClick:e=>Y(l)},B(e.label),11,O),V(W).isMini?(b(),_("span",{key:0,class:"dept-tree__node-icon",onClick:t=>te(t,l,e)},[k(t,null,{default:g((()=>[k(V(c))])),_:1})],8,U)):I("",!0)])]})),_:1},8,["data","draggable"])),[[m,R.value]])])),_:1})],40,M),k(s,{ref_key:"Form",ref:D},null,512)])}}}),[["__scopeId","data-v-716fde60"]]),D=f({name:"cms-field"}),P=f({...D,setup(t){const{service:a}=s(),{ViewGroup:r}=e(),n=l.useUpsert({items:[{label:"标题",prop:"name",required:!0,component:{name:"el-input"}},{label:"字段类型",prop:"fieldTypeId",required:!0,component:{name:"el-select",options:[]}},{label:"备注",prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:4}}},{label:"状态",prop:"status",value:1,component:{name:"el-switch",props:{activeValue:1,inactiveValue:0}}}],onOpen(){a.cms.fieldType.list().then((e=>{var l;null==(l=n.value)||l.setOptions("fieldTypeId",e.map((e=>({label:e.name,value:e.id}))))}))},onSubmit(e,{next:l}){var t,a;l({...e,modelTypeId:null==(a=null==(t=r.value)?void 0:t.selected)?void 0:a.id})}}),o=l.useTable({columns:[{type:"selection"},{label:"标题",prop:"name"},{label:"备注",prop:"remark"},{type:"op",buttons:["edit","delete"]}]}),i=l.useCrud({service:a.cms.field});function d(e){var l;null==(l=i.value)||l.refresh(e)}return(e,l)=>{const t=h("cl-refresh-btn"),a=h("cl-add-btn"),s=h("cl-multi-delete-btn"),u=h("cl-flex1"),p=h("cl-search-key"),c=h("cl-row"),m=h("cl-table"),f=h("cl-pagination"),v=h("cl-upsert"),j=h("cl-crud"),_=h("cl-view-group");return b(),C(_,{ref_key:"ViewGroup",ref:r},{left:g((()=>[k(A,{onRefresh:d})])),right:g((()=>[k(j,{ref_key:"Crud",ref:i},{default:g((()=>[k(c,null,{default:g((()=>[k(t),k(a),k(s),k(u),k(p)])),_:1}),k(c,null,{default:g((()=>[k(m,{ref_key:"Table",ref:o},null,512)])),_:1}),k(c,null,{default:g((()=>[k(u),k(f)])),_:1}),k(v,{ref_key:"Upsert",ref:n},null,512)])),_:1},512)])),_:1},512)}}});export{P as default};
