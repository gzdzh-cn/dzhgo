import{i as e}from"./index.umd.min-ead3793b.js";import{u as o,e as r}from"./browser-f4ca2ed3.js";import"./vue-echarts-bffdbdc9.js";import"./element-plus-e665fdbc.js";import"./store-acbd10e3.js";import"./index-ecdd2562.js";import{u as t}from"./index-1fe6d5c5.js";import{d as a}from"./dayjs-f8876307.js";import{d as l,W as s,o as p,I as i,J as n,a as m,b as d}from"./@vue.runtime-core-6173334e.js";import{r as u}from"./@vue.reactivity-54707199.js";import"./axios-bb93cf32.js";import"./vue-21f38777.js";import"./@vue.runtime-dom-532828a1.js";import"./@vue.shared-0cc4c744.js";import"./monaco-editor-c28fb00f.js";import"./nprogress-27d9be10.js";import"./lodash-es-fd5b777b.js";import"./vue-router-25454f45.js";import"./@vueuse.core-cb7ad152.js";import"./@vueuse.shared-feb01f08.js";import"./pinia-77f7f468.js";import"./vue-demi-71ba0ef2.js";import"./mockjs-005b47e8.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@element-plus.icons-vue-e9c91902.js";import"./@popperjs.core-b696b006.js";import"./@ctrl.tinycolor-a951068a.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";const c={style:{padding:"10px 10px 0px 20px",display:"flex","flex-wrap":"wrap","row-gap":"10px"}},v=m("div",{class:"divider"},null,-1),f=l({name:"crm-domain"}),j=l({...f,setup(l){const{service:f}=t(),{user:j}=o(),{dict:b}=r(),y=u(1!=j.info.id),Y=e.useUpsert({items:[{label:"会员",prop:"uid",required:!0,span:12,value:j.info.id,hidden:()=>1!=j.info.id,component:{name:"el-select",options:[],props:{}}},{label:"项目订单",prop:"orderCode",span:12,component:{name:"slot-orderCode"}},{label:"域名",prop:"domain",span:12,component:{name:"el-input"}},{label:"注册时间",prop:"startDate",span:12,value:a().format("YYYY-MM-DD"),component:{name:"el-date-picker",props:{type:"date",valueFormat:"YYYY-MM-DD"}},group:"base"},{label:"到期时间",prop:"endDate",span:12,value:a().add(1,"year").format("YYYY-MM-DD"),component:{name:"el-date-picker",props:{type:"date",valueFormat:"YYYY-MM-DD"}},group:"base"},{label:"域名商",prop:"domainCompany",span:12,component:{name:"el-select",options:b.get("domainProvider")}},{label:"实名资料",prop:"realNameDataFiles",component:{name:"cl-upload",props:{type:"file",multiple:!0,showFileList:!0,draggable:!0,rename:!1}}}],async onOpen(){var e;if(1==j.info.id){const o=await f.base.sys.user.list();null==(e=Y.value)||e.setOptions("uid",o.map((e=>({label:e.nickName||"",value:e.id||""}))))}},onSubmit(e,{next:o}){var r;let t={};1!=(null==(r=j.info)?void 0:r.id)&&(t.uid=j.info.id),t.projectNum=e.orderCode.split("-")[0],o({...e,...t})}}),g=e.useTable({columns:[{type:"selection"},{label:"会员",prop:"userName",hidden:y},{label:"项目",prop:"orderCode"},{label:"域名",prop:"domain"},{label:"域名商",prop:"domainCompany",dict:{text:!0,separator:"",options:b.get("domainProvider").value}},{label:"注册时间",prop:"startDate",component:{name:"cl-date-text",props:{format:"YYYY-MM-DD"}}},{label:"续费时间",prop:"endDate",component:{name:"cl-date-text",props:{format:"YYYY-MM-DD"}}},{type:"op",buttons:["edit","delete"]}]}),h=e.useCrud({service:f.crm.domain,async onRefresh(e,{render:o}){const{list:r,pagination:t}=await f.crm.domain.page(e);o(r,t)}},(e=>{e.refresh()})),x=u([]),D=u(!1),C=async e=>{if(""!==e){D.value=!0;const o=await f.crm.order.list({keyWord:e});D.value=!1,x.value=o.map((e=>{const o=M(e.orderType);return{label:(null==o?void 0:o.label)+"-"+e.orderCode,value:e.orderCode}}))}},M=e=>{const o=b.get("orderType").value.filter((o=>o.value==e));if(o.length>0)return o[0];const r=b.get("subOrderType").value.filter((o=>o.value==e));return r.length>0?r[0]:{}};return(e,o)=>{const r=s("cl-refresh-btn"),t=s("cl-add-btn"),a=s("cl-multi-delete-btn"),l=s("cl-search-key"),u=s("cl-flex1"),f=s("cl-table"),j=s("cl-row"),b=s("cl-pagination"),y=s("el-select-v2"),M=s("cl-upsert"),w=s("cl-crud");return p(),i(w,{ref_key:"Crud",ref:h},{default:n((()=>[m("div",c,[d(r),d(t),d(a,{style:{"margin-right":"10px"}}),d(l),d(u)]),v,d(j,null,{default:n((()=>[d(f,{ref_key:"Table",ref:g,border:!1},null,512)])),_:1}),d(j,null,{default:n((()=>[d(u),d(b)])),_:1}),d(M,{ref_key:"Upsert",ref:Y},{"slot-orderCode":n((({scope:e})=>[d(y,{modelValue:e.orderCode,"onUpdate:modelValue":o=>e.orderCode=o,filterable:"",remote:"","remote-method":C,clearable:"",options:x.value,loading:D.value,placeholder:"请输入订单号"},null,8,["modelValue","onUpdate:modelValue","options","loading"])])),_:1},512)])),_:1},512)}}});export{j as default};
